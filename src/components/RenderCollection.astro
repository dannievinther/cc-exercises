---
const { collection, theme, hasWarning, devNotice } = Astro.props;

import { getCollection } from "astro:content";
import Exercises from "../components/Exercises.astro";
import SDAExercises from "../components/SDAExercises.astro";
import Base from "../layouts/Base.astro";

const exEntries = await getCollection(collection);

// Vis drafts i dev-mode eller pÃ¥ staging branch (Vercel)
const isStaging = process.env.VERCEL_GIT_COMMIT_REF === "staging";
const showDrafts = import.meta.env.DEV || isStaging;

const filtered = exEntries.filter(
  (entry: { data: { draft?: boolean } }) => showDrafts || !entry.data.draft
);

const sorted = filtered.sort((a: { id: string }, b: { id: string }) =>
  a.id.localeCompare(b.id, undefined, { numeric: true })
);

const title = collection.charAt(0).toUpperCase() + collection.slice(1);

// Use SDA-specific component for scroll-driven animations
const ExerciseComponent = collection === "sda" ? SDAExercises : Exercises;
---

<Base {title} {hasWarning} {theme}>
  {
    devNotice && (
      <aside class="dev-notice">
        <span>ðŸš§</span> Disse Ã¸velser er under udvikling
      </aside>
    )
  }
  {
    sorted.map((entry, index) => (
      <ExerciseComponent {entry} index={index + 1} total={sorted.length} />
    ))
  }
</Base>

<style>
  .dev-notice {
    grid-column: 2;
    place-self: center;
    padding: 0.75rem 1rem;
    background: oklch(from var(--yellow-200) 0.98 0.06 h);
    border: 1px solid oklch(from var(--yellow-200) 0.8 0.4 h);
    border-radius: 6px;
    font-size: 0.9rem;
    color: oklch(from var(--yellow-200) 0.4 0.1 h);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-block-end: calc(-1 * (var(--space-9) / 2));
    font-weight: 500;
  }
</style>
