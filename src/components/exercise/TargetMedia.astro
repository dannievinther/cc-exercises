---
// import { Image } from "astro:assets";
import { Picture } from "astro:assets";
import PlayButton from "./PlayButton.astro";
const {
  index,
  image,
  video,
  isSDA = false,
  videoWidth = 800,
  videoHeight = 600,
} = Astro.props;
// Use lazy loading for all items except first, and preload="none" for videos below fold
const isFirst = index === 1;
---

{
  video ? (
    <picture>
      {isSDA ? (
        <div class="video-wrapper">
          <video
            muted
            loop
            playsinline
            preload="metadata"
            width={videoWidth}
            height={videoHeight}
          >
            <source src={video + "#t=0.001"} type="video/webm" />
          </video>
          <play-button>
            <PlayButton />
          </play-button>
        </div>
      ) : (
        <div class="video-wrapper">
          <video
            muted
            loop
            playsinline
            preload="metadata"
            width={videoWidth}
            height={videoHeight}
          >
            <source src={video + "#t=0.001"} type="video/mp4" />
          </video>
          <play-button>
            <PlayButton />
          </play-button>
        </div>
      )}
    </picture>
  ) : image ? (
    <Picture
      src={image}
      alt=""
      loading={isFirst ? "eager" : "lazy"}
      fetchpriority={isFirst ? "high" : "low"}
      format="avif"
      formats={["avif", "webp"]}
    />
  ) : null
}

<style>
  :global(picture) {
    padding-inline: calc(var(--space-1) / 2);
  }
  img {
    background: #f1eef5;
  }
  .video-wrapper {
    position: relative;
    cursor: pointer;
  }
</style>
